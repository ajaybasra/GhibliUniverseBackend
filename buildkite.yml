---
steps:
  - label: ':test_tube: Building Image and Running tests'
    command: 'docker build -t test --target test .'
    agents:
      queue: fma-dev

  - wait

  - label: "ðŸ”Ž Run SonarQube scan"
    command: "./.sonarqube/scan.sh"
    agents:
      queue: "fma-dev"      

  - wait

  - label: ':docker: Building Image and Pushing to Cloudsmith'
    branches: 'main'
    command: ./scripts/build-and-push.sh
    agents:
      queue: fma-dev 

  - wait

  - label: ":k8s: Deploy to Europa Pre-Prod"
    command: ./scripts/deploy.sh
    branches: main
    agents:
      queue: "europa-preprod-fma" 